{% extends 'layouts/base.twig' %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="bi bi-info-circle"></i>
        Sobre o Sistema
    </h1>
</div>

<!-- Informações da Versão -->
<div class="row mb-4">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-tag"></i>
                    Informações da Versão
                </h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <td><strong>Versão:</strong></td>
                        <td>
                            {{ version_data.version }}
                            <span class="badge bg-{{ version_data.stability == 'stable' ? 'success' : (version_data.stability == 'beta' ? 'warning' : 'danger') }}">
                                {{ version_data.stability|upper }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Build:</strong></td>
                        <td><code>{{ version_data.build }}</code></td>
                    </tr>
                    <tr>
                        <td><strong>Data de Lançamento:</strong></td>
                        <td>{{ version_data.release_date|date('d/m/Y') }}</td>
                    </tr>
                    <tr>
                        <td><strong>Codinome:</strong></td>
                        <td>{{ version_data.codename }}</td>
                    </tr>
                    <tr>
                        <td><strong>PHP Mínimo:</strong></td>
                        <td>{{ version_data.php_min }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-server"></i>
                    Informações do Sistema
                </h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <td><strong>PHP:</strong></td>
                        <td>{{ system_info.php_version }}</td>
                    </tr>
                    <tr>
                        <td><strong>Servidor:</strong></td>
                        <td>{{ system_info.server_software }}</td>
                    </tr>
                    <tr>
                        <td><strong>Memória:</strong></td>
                        <td>{{ system_info.memory_limit }}</td>
                    </tr>
                    <tr>
                        <td><strong>Tempo Execução:</strong></td>
                        <td>{{ system_info.max_execution_time }}s</td>
                    </tr>
                    <tr>
                        <td><strong>Upload Máximo:</strong></td>
                        <td>{{ system_info.upload_max_filesize }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Extensões PHP -->
<div class="row mb-4">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-puzzle"></i>
                    Extensões PHP
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for extension, loaded in required_extensions %}
                    <div class="col-6 mb-2">
                        <span class="badge bg-{{ loaded ? 'success' : 'danger' }} me-2">
                            <i class="bi bi-{{ loaded ? 'check' : 'x' }}"></i>
                        </span>
                        {{ extension }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-database"></i>
                    Banco de Dados
                </h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <td><strong>Host:</strong></td>
                        <td>{{ db_info.host ?? 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Database:</strong></td>
                        <td>{{ db_info.database ?? 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Prefixo:</strong></td>
                        <td><code>{{ db_info.prefix ?? 'N/A' }}</code></td>
                    </tr>
                    <tr>
                        <td><strong>Status:</strong></td>
                        <td>
                            <span class="badge bg-{{ db_info.connection == 'Conectado' ? 'success' : 'danger' }}">
                                {{ db_info.connection }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Versão:</strong></td>
                        <td>{{ db_info.version ?? 'N/A' }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Dependências -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-box"></i>
                    Dependências (Composer)
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for package, version in dependencies %}
                    <div class="col-md-6 col-lg-4 mb-2">
                        <strong>{{ package }}:</strong> <code>{{ version }}</code>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Changelog -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-journal-text"></i>
                    Changelog (Últimas Versões)
                </h5>
                <a href="https://github.com/seu-usuario/sistema-administrativo-mvc/blob/main/CHANGELOG.md" 
                   target="_blank" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-box-arrow-up-right"></i>
                    Ver Completo
                </a>
            </div>
            <div class="card-body">
                <div class="changelog-content" style="max-height: 400px; overflow-y: auto;">
                    <pre class="text-wrap">{{ changelog_content }}</pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Adiciona syntax highlighting básico para o changelog
document.addEventListener('DOMContentLoaded', function() {
    const changelogContent = document.querySelector('.changelog-content pre');
    if (changelogContent) {
        let html = changelogContent.innerHTML;
        
        // Destaca títulos de versão
        html = html.replace(/^## \[([^\]]+)\]/gm, '<strong class="text-primary">## [$1]</strong>');
        
        // Destaca seções
        html = html.replace(/^### (.+)/gm, '<strong class="text-success">### $1</strong>');
        
        // Destaca itens
        html = html.replace(/^- (.+)/gm, '<span class="text-muted">-</span> $1');
        
        changelogContent.innerHTML = html;
    }
});
</script>
{% endblock %}